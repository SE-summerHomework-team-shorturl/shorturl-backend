# 后端性能测试
## 测试环境
**测试工具**: JMeter 5.3

**部署方式**: 所有组件部署在同一台服务器上.

**服务器参数**:

| 参数 | 值 |
| - | - |
| 处理器 | Intel Core i7-8550U |
| 内存大小 | 8.00GB |
| 硬盘 | KXG50ZNV256G NVMe TOSHIBA 256GB |

## 重定向服务响应时间
**测试内容**: 不同并发量下, 重定向服务的响应时间.

**测试方法**: 在不同的的并发量情况下, 测试重定向服务, 每次测试时, 记录响应时间的中位数, 平均数, 90%分位点与95%分位点. 每次发送请求时, 随机选择一个数据库中的短链接作为目标. JMeter设置不跟随重定向.

**实例个数**: redirect-service部署1个实例.

**数据量**: 数据库中预先存入100000条短链接.

**循环次数**: 每个线程循环200次.

**结果**:
![redirect-concurrency.png](https://i.loli.net/2020/08/27/hHc2WQJX3NKordR.png)

**分析**: 在400并发, 数据库中存有100000条短链接的情况下, 重定向服务响应时间的95%分位点在400ms以内.

## 添加短链接服务响应时间
**测试内容**: 不同并发量下, 添加短链接服务的响应时间.

**测试方法**: 在不同的的并发量情况下, 测试添加短链接服务, 每次测试时, 记录响应时间的平均数, 90%分位点与95%分位点.

**实例个数**: addurl-service部署1个实例.

**数据量**: 每次测试开始前, 清除数据库中的所有短链接.

**循环次数**: 每个线程循环200次.

**结果**:
![addurl-concurrency.png](https://i.loli.net/2020/08/27/r64vMbnlH71ZDmB.png)

**分析**: 在400并发的情况下, 重定向服务响应时间的95%分位点在1600ms以内.

## 网关与点击量统计对重定向服务性能的影响
**测试内容**: 研究去除网关或点击量统计的情况下, 重定向服务的响应时间的变化.

**测试方法**:  测试普通, 无网关, 无点击量统计三种情况下, 重定向服务的响应时间的90%分位点关于并发量的变化. 无网关模式下, 请求直接发送给redirect-service实例(只部署1个实例). 无点击量统计情况下, 重定向服务流程中不向RabbitMQ添加redirect record.

**实例个数**: redirect-service部署1个实例.

**数据量**: 数据库中预先存入100000条短链接.

**循环次数**: 每个线程循环200次.

**结果**:
![redirect-cases.png](https://i.loli.net/2020/08/27/O9uihVFAQ2UCkaZ.png)

**分析**: 去除网关或点击量统计会使得重定向服务响应时间变短, 但变短的幅度都不大, 可以认为网关与点击量统计对于重定向服务的性能没有太大的影响.

## 微服务实例数目对重定向服务性能的影响(单台服务器)
**测试内容**: 不同redirect-service实例数目下, 重定向服务的响应时间. 所有redirect-service实例部署在一台服务器上.

**测试方法**: 在不同的redirect-service实例数目下, 测试重定向服务的响应时间的90%分位点关于并发量的变化. 所有redirect-service实例部署在一台服务器上.

**数据量**: 数据库中预先存入100000条短链接.

**循环次数**: 每个线程循环200次.

**结果**:
![redirect-single-machine-multi-inst.png](https://i.loli.net/2020/08/27/EibvyH3swd1XmOu.png)

**分析**: 在一台服务器上部署多个redirect-service实例, 部署的实例数增加, 重定向服务的响应时间增长. 这可能是由于实例数增加时, 服务器的硬件资源消耗增加所致的. 要通过增加实例数目提高重定向服务的性能, 需要将各个实例部署在不同的服务器上.
